<!DOCTYPE js>
<html>

<head>
    <meta charset="UTF-8" />
    <title>PayBack</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
    <link rel="icon" href="assets/images/icon.ico">


    <style type="text/css">
        body {
            margin: 0;
            padding: 7%;
            text-align: center;
            background-color: #021B36;
        }
    </style>
</head>

<body>
    <audio src="assets/sounds/music.mp3" autoplay loop>Music</audio>
    <script type="text/javascript">

        "use strict";
        class EscenaJuego extends Phaser.Scene {

            constructor() {
                super('GameScene');

                //Elementos de la escena
                this.sky;
                this.platforms;
                
                //Players
                this.player1;
                this.player2;

                //Pad
                this.cursors;

                //Vidas
                this.vidasply1;
                this.vidasply2;

                //Sprite de las vidas
                this.imgvidasply2;
                this.imgvidasply1;

                //Impactos
                this.impactoP1 = false;
                this.impactoP2 = false;

                //Ultimas direcciones de los players
                this.lastP1direction;
                this.lastP2direction;

                //GameOver
                this.gameOver = false;

                //Botón de pausa
                this.pauseButtonContainer;


            }

            initialize() {
                Phaser.Scene.call(this, { key: 'GameScene' });
                // Reiniciar las vidas según sea necesario
                this.vidasply1 = 3;
                this.vidasply2 = 3;
            }

            preload() {
                //Imagenes escenario
                this.load.image('suelo', 'assets/images/platform.png');
                this.load.image('muro', 'assets/images/muro.png');
                this.load.image('fondo', 'assets/images/background.jpeg');

                //Hojas de sprites de los personajes y disparo                
                this.load.spritesheet('personaje1',
                    'assets/images/sprite personaje1.png',
                    { frameWidth: 568, frameHeight: 633 }
                );

                this.load.spritesheet('personaje2',
                    'assets/images/sprite personaje2.png',
                    { frameWidth: 568, frameHeight: 633 }
                );

                this.load.spritesheet('disparo',
                    'assets/images/disparo2.png',
                    { frameWidth: 254, frameHeight: 120 } 
                );
                //this.load.image('disparo', 'assets/images/disparo.jpeg');

                //Imagenes de las vidas
                this.load.image('vidas player1 3', 'assets/images/vidas roja 3.png');
                this.load.image('vidas player1 2', 'assets/images/vidas roja 2.png');
                this.load.image('vidas player1 1', 'assets/images/vidas roja 1.png');
                this.load.image('vidas player2 3', 'assets/images/vidas azul 3.png');
                this.load.image('vidas player2 2', 'assets/images/vidas azul 2.png');
                this.load.image('vidas player2 1', 'assets/images/vidas azul 1.png');

                //Boton de pausa
                this.load.image('botonPausa', 'assets/images/pausa.png')

                //Sonido disparo
                this.load.audio('myGunSound', 'assets/sounds/bang.mp3');

                //Sonido daño 
                this.load.audio('ouch', 'assets/sounds/hit.mp3');

            }

            create() {
                //Añadimos el fondo
                this.sky = this.add.image(400, 300, 'fondo');
                this.sky.setDepth(-1);
                this.sky.setDisplaySize(800, 600);


                //Añadimos el boton de pausa
                this.pauseImage = this.add.image(0, 0, 'botonPausa').setDepth(2);
                //Lo hacemos interactivo
                this.pauseButtonContainer = this.add.container(400, 50, [this.pauseImage]);
                this.pauseButtonContainer.setSize(this.pauseImage.height, this.pauseImage.width);
                this.pauseButtonContainer.setInteractive();       

                if (this.pauseButtonContainer) {
                    this.pauseButtonContainer.on('pointerdown', () => {
                        if (this.scene && this.scene.wake && this.scene.pause) {
                            this.scene.wake('PauseMenuScene');
                            this.scene.bringToTop('PauseMenuScene');
                            this.scene.pause('GameScene');
                        }
                    });
                }

                if (this.pauseButtonContainer && this.pauseImage) {
                    this.pauseButtonContainer.on('pointerover', () => {
                        this.pauseImage.setScale(1.2);
                    });

                    this.pauseButtonContainer.on('pointerout', () => {
                        this.pauseImage.setScale(1);
                    });
                }


                //Añadimos las plataformas
                //Las hacemos estáticas
                this.platforms = this.physics.add.staticGroup();

                //Colocamos el suelo
                this.platforms.create(400, 600, 'suelo').setScale(2).refreshBody();

                //Colocamos las plataformas
                this.platforms.create(195, 240, 'suelo').setDisplaySize(255, 32).refreshBody(); 
                this.platforms.create(140, 470, 'suelo').setDisplaySize(95, 32).refreshBody();
                this.platforms.create(530, 300, 'suelo').setDisplaySize(125, 25).refreshBody();
                this.platforms.create(750, 400, 'suelo').setDisplaySize(110, 25).refreshBody(); 
                this.platforms.create(400, 430, 'suelo').setDisplaySize(125, 20).refreshBody();
                this.platforms.create(450, 200, 'suelo').setDisplaySize(100, 25).refreshBody();
                this.platforms.create(550, 450, 'suelo').setDisplaySize(150, 25).refreshBody();
                this.platforms.create(250, 350, 'suelo').setDisplaySize(105, 25).refreshBody();

                //Colocamos los muros
                this.platforms.create(250, 540, 'muro').setDisplaySize(32, 60).refreshBody();
                this.platforms.create(375, 510, 'muro').setDisplaySize(25, 140).refreshBody();
                this.platforms.create(585, 380, 'muro').setDisplaySize(32, 130).refreshBody();
                this.platforms.create(205, 190, 'muro').setDisplaySize(32, 80).refreshBody();


                //Colocamos las vidas
                this.imgvidasply1 = this.add.image(100, 40, 'vidas player1 3').setDepth(2).setDisplaySize(260, 260);
                this.imgvidasply1.flipX = false;
                this.imgvidasply2 = this.add.image(700, 40, 'vidas player2 3').setDepth(2).setDisplaySize(260, 260);
                this.imgvidasply2.flipX = true;

                //Colocamos al player1
                this.player1 = this.physics.add.sprite(500, 500, 'personaje1');
                this.player1.setDisplaySize(32, 48);
                this.player1.setCollideWorldBounds(true);
                this.lastP1direction = 'right';


                //Colocamos al player2
                this.player2 = this.physics.add.sprite(300, 500, 'personaje2');
                this.player2.setDisplaySize(32, 48);
                this.player2.setCollideWorldBounds(true);
                this.lastP2direction = 'right';

                //Animaciones del player1
                this.anims.create({
                    key: 'play1right',
                    frames: this.anims.generateFrameNumbers('personaje1', { start: 0, end: 4}),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'play1left',
                    frames: this.anims.generateFrameNumbers('personaje1', { start: 6, end: 10 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'play1front',
                    frames: [{ key: 'personaje1', frame: 5 }],
                    frameRate: 20
                });

                //Animaciones del player2
                this.anims.create({
                    key: 'play2right',
                    frames: this.anims.generateFrameNumbers('personaje2', { start: 0, end: 4 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'play2left',
                    frames: this.anims.generateFrameNumbers('personaje2', { start: 6, end: 10 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'play2front',
                    frames: [{ key: 'personaje2', frame: 5 }],
                    frameRate: 20
                });


                //Animaciones de disparo
                this.anims.create({
                    key: 'disp',
                    frames: this.anims.generateFrameNumbers('disparo', { start: 0, end: 4 }),
                    frameRate: 4,
                    repeat: -1
                });

                //Collider entre player y plataformas
                this.physics.add.collider(this.player1, this.platforms);
                this.physics.add.collider(this.player2, this.platforms);
                //Pad
                this.cursors = this.input.keyboard.createCursorKeys();
                //Teclas
                this.keyP = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.P);
                this.keyA = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A);
                this.keyS = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S);
                this.keyD = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D);
                this.keyW = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W);
                this.keyF = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.F);

                //Disparos 
                this.disparosP1 = new Player1BulletGroup(this);
                this.disparosP2 = new Player2BulletGroup(this);
                //Collider entre player y disparos
                this.physics.add.collider(this.disparosP1, this.player2, this.hitPlayer2, null, this);
                this.physics.add.collider(this.disparosP2, this.player1, this.hitPlayer1, null, this);
                this.physics.add.collider(this.disparosP1, this.platforms);
                this.physics.add.collider(this.disparosP2, this.platforms);

                this.vidasply1 = 3;
                this.vidasply2 = 3;                
            }

            //Metodo para disparo de player1
            shootdisparoP1(xpos, ypos, direc) {
                this.disparosP1.fireBalaP1(xpos, ypos, direc);                
                this.sound.play('myGunSound');
            }
            //Metodo para disparo de player2
            shootdisparoP2(xpos, ypos, direc) {
                this.disparosP2.fireBulletP2(xpos, ypos, direc);                
                this.sound.play('myGunSound');
            }


            update() {

                //Movimiento player1
                if ((this.keyA).isDown) {
                    this.player2.setVelocityX(-100);

                    this.player2.anims.play('play2left', true);
                    this.lastP2direction = 'left';
                }
                else if ((this.keyD).isDown) {
                    this.player2.setVelocityX(100);

                    this.player2.anims.play('play2right', true);
                    this.lastP2direction = 'right';
                }
                else {
                    this.player2.setVelocityX(0);

                    this.player2.anims.play('play2front');
                }

                if ((this.keyW).isDown && this.player2.body.touching.down) {
                    this.player2.setVelocityY(-500);
                }

                //Movimiento del player2
                if (this.cursors.left.isDown) {
                    this.player1.setVelocityX(-100);

                    this.player1.anims.play('play1left', true);
                    this.lastP1direction = 'left';
                }
                else if (this.cursors.right.isDown) {
                    this.player1.setVelocityX(100);

                    this.player1.anims.play('play1right', true);
                    this.lastP1direction = 'right';
                }
                else {
                    this.player1.setVelocityX(0);

                    this.player1.anims.play('play1front');
                }

                if (this.cursors.up.isDown && this.player1.body.touching.down) {
                    this.player1.setVelocityY(-500);
                }

                //Disparo del player 1
                if ((Phaser.Input.Keyboard.JustDown(this.keyF))) {
                    if (this.player1.body.touching.left & this.lastP2direction == 'left') {

                    }
                    else if (this.player1.body.touching.right & this.lastP2direction == 'right') {

                    }
                    else {
                        this.shootdisparoP2(this.player2.x, this.player2.y, this.lastP2direction);
                    }
                }

                //Disparo del player 2
                if ((Phaser.Input.Keyboard.JustDown(this.keyP))) { 
                    if (this.player1.body.touching.left & this.lastP1direction == 'left') {

                    }
                    else if (this.player1.body.touching.right & this.lastP1direction == 'right') {

                    }
                    else {
                        this.shootdisparoP1(this.player1.x, this.player1.y, this.lastP1direction);

                    }
                }

                //Si el player 1 sufre un impacto se tiñe de rojo durante 0.3 secs
                if (this.impactoP2 == true) {
                    this.player2.setTint(0xff0000);
                    //Sonido                
                    this.sound.play('ouch');
                    setTimeout(() => {
                        this.player2.setTint(0xffffff);
                    }, "300")
                    this.impactoP2 = false;
                }

                //Si el player 2 sufre un impacto se tiñe de rojo durante 0.3 secs
                if (this.impactoP1 == true) {
                    this.player1.setTint(0xff0000);
                    //Sonido
                    this.sound.play('ouch');
                    setTimeout(() => {
                        this.player1.setTint(0xffffff);
                    }, "300");
                    this.impactoP1 = false;
                }

                //Si el player 2 se queda sin vidas
                else if (this.gameOver == true && this.vidasply2 == 0) {
                    this.vidasply1 = 3;
                    this.vidasply2 = 3;
                    this.gameOver = false;
                    this.scene.start('EscenaFinalP1');
                    this.scene.bringToTop('EscenaFinalP1');
                }

                //Si el player 1 se queda sin vidas
                if (this.gameOver == true && this.vidasply1 == 0) {
                    this.vidasply1 = 3;
                    this.vidasply2 = 3;
                    this.gameOver = false;
                    this.scene.start('EscenaFinalP2');
                    this.scene.bringToTop('EscenaFinalP2');
                }

            }

            
            //Cuando del player 1 es impactado se resta una vida y se sobre pone el sprite de la vida que tiene
            hitPlayer1(disparosP2, player) {
                if (this.vidasply2 > 0) {
                    this.vidasply2 = this.vidasply2 - 1;
                    this.impactoP1 = true;
                    if (this.vidasply2 == 2) {
                        this.imgvidasply2 = this.add.image(700, 40, 'vidas player2 2').setDepth(2).setDisplaySize(260, 260);
                        this.imgvidasply2.flipX = true;

                    }
                    if (this.vidasply2 == 1) {                        
                        this.imgvidasply2 = this.add.image(700, 40, 'vidas player2 1').setDepth(2).setDisplaySize(260, 260);
                        this.imgvidasply2.flipX = true;                       

                    }
                }
                //Cuando se queda sin vidas gameOver es true
                if (this.vidasply2 < 1) {
                    this.physics.pause();
                    this.player1.setTint(0xff0000);
                    this.gameOver = true;
                }
            }
            //Cuando del player 2 es impactado se resta una vida y se sobre pone el sprite de la vida que tiene
            hitPlayer2(disparosP1, player) {
                if (this.vidasply1 > 0) {
                    this.vidasply1 = this.vidasply1 - 1;
                    this.impactoP2 = true;
                    if (this.vidasply1 == 2) {
                        this.imgvidasply1 = this.add.image(100, 40, 'vidas player1 2').setDepth(2).setDisplaySize(260, 260);
                        this.imgvidasply1.flipX = false;

                    }
                    if (this.vidasply1 == 1) {
                        this.imgvidasply1 = this.add.image(100, 40, 'vidas player1 1').setDepth(2).setDisplaySize(260, 260);
                        this.imgvidasply1.flipX = false;

                    }
                }
                //Cuando se queda sin vidas gameOver es true
                if (this.vidasply1 < 1) {
                    this.physics.pause();
                    this.player2.setTint(0xff0000);
                    this.gameOver = true;
                }
            }

        }
        
        //Disparos del player 1
        class Player1BulletGroup extends Phaser.Physics.Arcade.Group {
            constructor(scene) {
                super(scene.physics.world, scene);
                this.createMultiple({
                    classType: Player1Bullet,
                    frameQuantity: 30,
                    active: false,
                    visible: false,
                    key: 'disp',
                    depth: 3,
                    setXY: { x: -100, y: -100 }
                })

                //Cooldown
                this.canShoot = true;
                this.shootCooldown = 500; // Tiempo de enfriamiento en milisegundos
            }

            fireBalaP1(x, y, direccion) {
                if(this.canShoot){
                    const bala = this.getFirstDead(false);
                    if (bala) {
                        bala.fireP1(x, y, direccion);
                        // Después de disparar, iniciar el cooldown
                        this.canShoot = false;
                        this.scene.time.addEvent({
                        delay: this.shootCooldown,
                        callback: () => {
                            this.canShoot = true;
                        },
                        callbackScope: this
                        });
                    }
                }
                
            }


        }
        //Comportamiento de las balas 
        class Player1Bullet extends Phaser.Physics.Arcade.Sprite {
            constructor(scene, x, y) {
                super(scene, x, y, 'disp');
            }

            fireP1(x, y, direction) {

                if (direction == 'left') {
                    this.flipX = true;
                    this.body.reset(x-80, y);
                    this.setVelocityX(-300);
                    this.anims.play('disp', true);
                    this.setOrigin(0, 0.5);

                }else if (direction == 'right') {
                    this.flipX = false;
                    this.body.reset(x, y);
                    this.setVelocityX(300);
                    this.setDepth(-1);
                    this.anims.play('disp', true);
                    this.setOrigin(0, 0.5);
                }
                this.setActive(true);
                this.setVisible(true);
                this.setDisplaySize(75, 16);
                //this.setSize(24, 20); // Ajustar el tamaño de la hitbox
                //this.setOffset(8, 12); // Ajustar la posición de la hitbox dentro del sprite
                this.body.setAllowGravity(false);
            }

            preUpdate(time, delta) {
                super.preUpdate(time, delta);

                //const screenWidth = this.scene.scale.width;

                if (this.x >= 800 || this.x <= 0) {
                    this.setActive(false);
                    this.setVisible(false);
                }
                if (this.body.velocity.x != 300 & this.body.velocity.x != -300) {
                    this.x = 0;
                    this.y = 0;
                    this.setActive(false);
                    this.setVisible(false);

                }
            }

        }


        //Disparos del player 2
        class Player2BulletGroup extends Phaser.Physics.Arcade.Group {
            constructor(scene) {
                super(scene.physics.world, scene);
                this.createMultiple({
                    classType: Player2Bullet,
                    frameQuantity: 30,
                    active: false,
                    visible: false,
                    key: 'disp',
                    setXY: { x: -100, y: -100 }
                })

                //Cooldown
                this.canShoot = true;
                this.shootCooldown = 500; // Tiempo de enfriamiento en milisegundos
            }

            fireBulletP2(x, y, direccion) {
                if(this.canShoot){
                    const bala = this.getFirstDead(false);
                    if (bala) {
                        bala.fireP2(x, y, direccion);
                        // Después de disparar, iniciar el cooldown
                        this.canShoot = false;
                        this.scene.time.addEvent({
                        delay: this.shootCooldown,
                        callback: () => {
                            this.canShoot = true;
                        },
                        callbackScope: this
                        });
                    }
                }
            }


        }
        //Comportamiento de las balas 
        class Player2Bullet extends Phaser.Physics.Arcade.Sprite {
            constructor(scene, x, y) {
                super(scene, x, y, 'disp');
            }

            fireP2(x, y, direction) {

                if (direction == 'left') {
                    this.flipX = true;
                    this.body.reset(x-100, y);
                    this.setVelocityX(-300);
                    this.anims.play('disp', true);
                    this.setOrigin(0, 0.5);

                }
                if (direction == 'right') {
                    this.flipX = false;
                    this.body.reset(x, y);
                    this.setVelocityX(300);
                    this.anims.play('disp', true);
                    this.setOrigin(0, 0.5);

                }

                this.setActive(true);
                this.setVisible(true);
                this.setDisplaySize(75, 16);
                //this.setSize(20, 10); // Ajustar el tamaño de la hitbox
                //this.setOffset(10, 3); // Ajustar la posición de la hitbox dentro del sprite

                this.body.setAllowGravity(false);
            }

            preUpdate(time, delta) {
                super.preUpdate(time, delta);

                if (this.x >= 800 | this.x <= 0) {
                    this.setActive(false);
                    this.setVisible(false);
                }
                if (this.body.velocity.x != 300 & this.body.velocity.x != -300) {
                    this.x = -100;
                    this.y = -100;
                    this.setActive(false);
                    this.setVisible(false);

                }
            }


        }
        class MainMenuScene extends Phaser.Scene {
            constructor() {
                super({ key: 'MainMenuScene' });
                // Elementos de la escena de menú inicial
                this.background;
                this.playButtonContainer;
                this.creditsButtonContainer;
                this.contrlButtonContainer;
            }

            preload() {
                // Imágenes de fondo y botón
                this.load.image('titleBackground', 'assets/images/titulo.jpeg');
                this.load.image('playButton', 'assets/images/botonJugar.png');
                this.load.image('creditsButton', 'assets/images/botonCredits.png');
                this.load.image('contrlButton', 'assets/images/botonContrl.png');
            }

            create() {
                // Añadimos la imagen de fondo
                this.background = this.add.image(400, 300, 'titleBackground').setDepth(-1);

                // Añadimos el botón de juego
                const playButton = this.add.image(0, 0, 'playButton');
                const creditsButton = this.add.image(0, 0, 'creditsButton');
                const contrlButton = this.add.image(0, 0, 'contrlButton');

                // Hacemos que el botón sea interactivo
                this.playButtonContainer = this.add.container(400, 450, [playButton]);
                this.playButtonContainer.setSize(playButton.height, playButton.width);
                this.playButtonContainer.setInteractive();
                // Hacemos que el botón sea interactivo
                this.creditsButtonContainer = this.add.container(400, 550, [creditsButton]);
                this.creditsButtonContainer.setSize(creditsButton.height, creditsButton.width);
                this.creditsButtonContainer.setInteractive();
                // Hacemos que el botón sea interactivo
                this.contrlButtonContainer = this.add.container(700, 50, [contrlButton]);
                this.contrlButtonContainer.setSize(contrlButton.height, contrlButton.width);
                this.contrlButtonContainer.setInteractive();

                // Si pulsamos, nos lleva a la escena de juego
                this.playButtonContainer.on('pointerdown', function () {
                    this.scene.scene.bringToTop('GameScene');
                    this.scene.scene.launch('PauseMenuScene');
                    this.scene.scene.launch('GameScene');
                    this.scene.scene.sleep('PauseMenuScene');
                });

                // Resalta el botón al pasar el puntero sobre él
                this.playButtonContainer.on('pointerover', function () {
                    playButton.setScale(1.5);
                });

                // Restaura la escala normal del botón al quitar el puntero
                this.playButtonContainer.on('pointerout', function () {
                    playButton.setScale(1);
                });

                // Si pulsamos, nos lleva a la escena de créditos
                this.creditsButtonContainer.on('pointerdown', function () {
                    this.scene.scene.bringToTop('CreditScene');
                    this.scene.scene.launch('CreditScene');
                });

                // Resalta el botón al pasar el puntero sobre él
                this.creditsButtonContainer.on('pointerover', function () {
                    creditsButton.setScale(1.5);
                });

                // Restaura la escala normal del botón al quitar el puntero
                this.creditsButtonContainer.on('pointerout', function () {
                    creditsButton.setScale(1);
                });
                
                // Si pulsamos, nos lleva a la escena de controles
                this.contrlButtonContainer.on('pointerdown', function () {
                    this.scene.scene.bringToTop('ContrlScene');
                    this.scene.scene.launch('ContrlScene');
                });

                // Resalta el botón al pasar el puntero sobre él
                this.contrlButtonContainer.on('pointerover', function () {
                    contrlButton.setScale(1.5);
                });

                // Restaura la escala normal del botón al quitar el puntero
                this.contrlButtonContainer.on('pointerout', function () {
                    contrlButton.setScale(1);
                });
            }
        }

        class PauseMenuScene extends Phaser.Scene {
            constructor() {
                super('PauseMenuScene');
                //Elementos de la escena de menú de pausa
                this.background;
                this.resumeButton;
                this.pauseImage;
                this.resumeButtonContainer;
                this.exitButtonContainer;
                this.exitButton;
                this.gameScene;
            }

            initialize() {
                Phaser.Scene.call(this, { key: 'PauseMenuScene' });
            }

            preload() {
                //Cargamos las imágenes
                this.load.image('botonReanudar', 'assets/images/botonJugar.png')
                this.load.image('botonPausa', 'assets/images/pausa.png')
                this.load.image('fondoPausa', 'assets/images/backgroundpausa.jpeg')
                this.load.image('botonExit', 'assets/images/botonSalir.png')
            }

            create() {
                //Añadimos la imagen de fondo
                this.background = this.add.image(400, 300, 'fondoPausa');
                //Añadimos la imagen de pausa
                this.pauseImage = this.add.image(400, 50, 'botonPausa');
                //Añadimos el boton de reanudar
                this.resumeButton = this.add.image(0, 0, 'botonReanudar');
                //Boton de salir
                this.exitButton = this.add.image(0, 0, 'botonExit');
                //Los hacemos interactivos
                this.resumeButtonContainer = this.add.container(400, 300, [this.resumeButton]);
                this.resumeButtonContainer.setSize(this.resumeButton.height, this.resumeButton.width);
                this.resumeButtonContainer.setInteractive();
                this.exitButtonContainer = this.add.container(700, 550, [this.exitButton]);
                this.exitButtonContainer.setSize(this.exitButton.height, this.exitButton.width);
                this.exitButtonContainer.setInteractive();

                this.resumeButtonContainer.on('pointerdown', function () {
                    this.scene.scene.sleep('PauseMenuScene');
                    this.scene.scene.resume('GameScene');
                })
                
                if (this.resumeButtonContainer && this.resumeButton) {
                    this.resumeButtonContainer.on('pointerover', () => {
                        this.resumeButton.setScale(1.2);
                    });

                    this.resumeButtonContainer.on('pointerout', () => {
                        this.resumeButton.setScale(1);
                    });
                }
                this.gameScene = this.scene.get('GameScene');

                this.exitButtonContainer.on('pointerdown', function () {
                    this.scene.scene.bringToTop('MainMenuScene');
                    this.scene.scene.start('MainMenuScene');
                })
                
                if (this.exitButtonContainer && this.exitButton) {
                    this.exitButtonContainer.on('pointerover', () => {
                        this.exitButton.setScale(1.2);
                    });

                    this.exitButtonContainer.on('pointerout', () => {
                        this.exitButton.setScale(1);
                    });
                }
            }

        }

        class VictoryScenePlayer1 extends Phaser.Scene {

            constructor() {
                super('EscenaFinalP1');
                //Elementos de la escena final
                this.background;
                this.restartButtonContainer;
                this.victoryTextPlayer1;
            }

            initialize() {
                Phaser.Scene.call(this, { key: 'EscenaFinalP1' });
            }

            preload() {
                //Cargamos las imágenes
                this.load.image('fondoFinal', 'assets/images/imagenFinal.png');
                this.load.image('botonReiniciar', 'assets/images/reiniciar.png');
                this.load.image('TextoW', 'assets/images/vicP1.png');

            }

            create() {
                //Colocamos la imagen de victoria
                this.victoryTextPlayer1 = this.add.image(400, 200, 'TextoW');
                this.victoryTextPlayer1.setScale(0.3);
                //Colocamos la imagen de fondo
                this.background = this.add.image(400, 300, 'fondoFinal');
                this.background.setDepth(-1);
                //Colocamos el botón
                var botonReiniciar = this.add.image(0, 0, 'botonReiniciar');
                //Lo hacemos interactivo
                this.restartButtonContainer = this.add.container(400, 400, [botonReiniciar]);
                this.restartButtonContainer.setSize(botonReiniciar.height, botonReiniciar.width);
                this.restartButtonContainer.setInteractive();

                this.restartButtonContainer.on('pointerdown', function () {
                    this.scene.scene.bringToTop('MainMenuScene');
                    this.scene.scene.start('MainMenuScene');
                })
                //Highlight
                this.restartButtonContainer.on('pointerover', function () {
                    botonReiniciar.setScale(1.3);
                })

                this.restartButtonContainer.on('pointerout', function () {
                    botonReiniciar.setScale(1);
                })


            }
        }

        class VictoryScenePlayer2 extends Phaser.Scene {

            constructor() {
                super('EscenaFinalP2');
                //Elementos de la escena final
                this.background;
                this.restartButtonContainer;
                this.victoryTextPlayer2;
            }

            initialize() {
                Phaser.Scene.call(this, { key: 'EscenaFinalP2' });
            }

            preload() {
                //Cargamos las imágenes
                this.load.image('fondoFinal', 'assets/images/imagenFinal.png');
                this.load.image('botonReiniciar', 'assets/images/reiniciar.png');
                this.load.image('TextoW', 'assets/images/vicP2.png');
            }

            create() {
                //Colocamos la imagen de victoria
                this.victoryTextPlayer2 = this.add.image(400, 200, 'TextoW');
                this.victoryTextPlayer2.setScale(0.3);
                //Colocamos la imagen de fondo
                this.background = this.add.image(400, 300, 'fondoFinal');
                this.background.setDepth(-1);
                //Colocamos el botón
                var botonReiniciarJ2 = this.add.image(0, 0, 'botonReiniciar');
                //Lo hacemos interactivo
                this.restartButtonContainer = this.add.container(400, 400, [botonReiniciarJ2]);
                this.restartButtonContainer.setSize(botonReiniciarJ2.height, botonReiniciarJ2.width);
                this.restartButtonContainer.setInteractive();

                this.restartButtonContainer.on('pointerdown', function () {
                    this.scene.scene.bringToTop('MainMenuScene');
                    this.scene.scene.start('MainMenuScene');
                })
                //Highlight
                this.restartButtonContainer.on('pointerover', function () {
                    botonReiniciarJ2.setScale(1.3);
                })

                this.restartButtonContainer.on('pointerout', function () {
                    botonReiniciarJ2.setScale(1);
                })
            }
        }
    
        class CreditScene extends Phaser.Scene{
            constructor() {
                super('CreditScene');
                //Elementos de la escena final
                this.background;
                this.returnButtonContainer;
            }

            initialize() {
                Phaser.Scene.call(this, { key: 'CreditScene' });
            }

            preload() {
                //Cargamos las imágenes
                this.load.image('fondoCreditos', 'assets/images/backgroundCredits.jpeg');
                this.load.image('botonReiniciar', 'assets/images/reiniciar.png');
            }

            create() {
                //Colocamos la imagen de fondo
                this.background = this.add.image(400, 300, 'fondoCreditos');
                this.background.setDepth(-1);
                //Colocamos el botón
                var botonVolver = this.add.image(0, 0, 'botonReiniciar');
                //Lo hacemos interactivo
                this.returnButtonContainer = this.add.container(700, 550, [botonVolver]);
                this.returnButtonContainer.setSize(botonVolver.height, botonVolver.width);
                this.returnButtonContainer.setInteractive();

                this.returnButtonContainer.on('pointerdown', function () {
                    this.scene.scene.bringToTop('MainMenuScene');
                    this.scene.scene.start('MainMenuScene');
                })
                //Highlight
                this.returnButtonContainer.on('pointerover', function () {
                    botonVolver.setScale(1.2);
                })

                this.returnButtonContainer.on('pointerout', function () {
                    botonVolver.setScale(1);
                })
            }
            
        }

        class ContrlScene extends Phaser.Scene{
            constructor() {
                super('ContrlScene');
                //Elementos de la escena final
                this.background;
                this.returnButtonContainer;
            }

            initialize() {
                Phaser.Scene.call(this, { key: 'ContrlScene' });
            }

            preload() {
                //Cargamos las imágenes
                this.load.image('fondoContrl', 'assets/images/backgroundContrl.jpg');
                this.load.image('botonReiniciar', 'assets/images/reiniciar.png');
            }

            create() {
                //Colocamos la imagen de fondo
                this.background = this.add.image(400, 300, 'fondoContrl');
                this.background.setDepth(-1);
                //Colocamos el botón
                var botonVolver = this.add.image(0, 0, 'botonReiniciar');
                //Lo hacemos interactivo
                this.returnButtonContainer = this.add.container(400, 550, [botonVolver]);
                this.returnButtonContainer.setSize(botonVolver.height, botonVolver.width);
                this.returnButtonContainer.setInteractive();

                this.returnButtonContainer.on('pointerdown', function () {
                    this.scene.scene.bringToTop('MainMenuScene');
                    this.scene.scene.start('MainMenuScene');
                })
                //Highlight
                this.returnButtonContainer.on('pointerover', function () {
                    botonVolver.setScale(1.2);
                })

                this.returnButtonContainer.on('pointerout', function () {
                    botonVolver.setScale(1);
                })
            }
            
        }
        //Config del tutorial reusado para el juego
        var config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 650 },
                    debug: false
                }
            },
            autoCenter: false,

            scene: [MainMenuScene, EscenaJuego, PauseMenuScene , VictoryScenePlayer1, VictoryScenePlayer2, CreditScene, ContrlScene],
        };

        var game = new Phaser.Game(config);


        
    </script>

</body>

</html>